@page
@model PortalArcomix.Pages.FornecedorVEModel
@{
    ViewData["Title"] = "FornecedorVE";
    Layout = "_Layout";
}

@if (Model.Fornecedor != null)
{
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar Column -->
            <div class="col-md-1 sidebar">
                @* Sidebar items refactored into a loop *@
                @{
                    var sidebarItems = new List<(string Link, string Icon, string Text)>
            {
            ("#DadosFornecedorCadastro", "fa-user", "Dados Fornecedor"),
            ("#DadosFiscaisCadastro", "fa-rectangle-list", "Dados Fiscais"),
            ("#DadosBancariosCadastro", "fa-money-check", "Dados Bancarios"),
            ("#ContatosCadastro", "fa-phone", "Contatos"),
            ("#NegociacaoFornecedor", "fa-file", "Negociação"),
            ("#SegurancaAlimentos", "fa-file", "Segurança Alimentos")
            };
                }
                @foreach (var item in sidebarItems)
                {
                    <div class="sidebar-item">
                        <a href="@item.Link" class="sidebar-link">
                            <i class="sidebar-icon fa @item.Icon"></i>
                            <span class="sidebar-text">@item.Text</span>
                        </a>
                    </div>
                }
            </div>

            <!-- Main Content Column -->
            <div class="col-md-11">
                <form method="post" onsubmit="return showSuccessMessage()">
                    <br />
                    <!-- Dados Fornecedor Card -->
                    <div class="card" id="DadosFornecedorCadastro">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <h4 style="color: #1878BB; margin-bottom: 20px;">Dados do Fornecedor</h4>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <hr />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2">
                                    <label class="control-label">CNPJ</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.CNPJ" class="form-control" readonly />
                                        <span asp-validation-for="Fornecedor.CNPJ" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <label class="control-label">Razão Social</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.RAZAOSOCIAL" id="Fornecedor_RAZAOSOCIAL" class="form-control" onblur="validateRazaoSocial()" />
                                        <span asp-validation-for="Fornecedor.RAZAOSOCIAL" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <label class="control-label">Fantasia</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.FANTASIA" id="Fornecedor_FANTASIA" class="form-control" onblur="validateFantasia()" />
                                        <span asp-validation-for="Fornecedor.FANTASIA" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1">
                                    <label class="control-label">IE</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.IE" id="Fornecedor_IE" class="form-control validate-required" onblur="validateIE()" />
                                        <span asp-validation-for="Fornecedor.IE" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-1">
                                    <label class="control-label">CNAE</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.CNAE" id="Fornecedor_CNAE" class="form-control validate-required" onblur="validateCNAE()" />
                                        <span asp-validation-for="Fornecedor.CNAE" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <label class="control-label">CEP</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.CEP" class="form-control validate-required" id="Fornecedor_CEP" onblur="fetchAddress(); validateCEP()" />
                                        <span asp-validation-for="Fornecedor.CEP" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <label class="control-label">Logradouro</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.LOGRADOURO" class="form-control validate-required" id="Fornecedor_LOGRADOURO" onblur="validateLogradouro()" />
                                        <span asp-validation-for="Fornecedor.LOGRADOURO" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-1">
                                    <label class="control-label">Número</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.NUMEROENDERECO" class="form-control" />
                                        <span asp-validation-for="Fornecedor.NUMEROENDERECO" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- New Row -->
                            <div class="row">
                                <div class="col-md-2">
                                    <label class="control-label">Bairro</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.BAIRRO" id="Fornecedor_BAIRRO" class="form-control validate-required" onblur="validateBairro()" />
                                        <span asp-validation-for="Fornecedor.BAIRRO" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label class="control-label">Complemento</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.COMPLEMENTO" class="form-control" />
                                        <span asp-validation-for="Fornecedor.COMPLEMENTO" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-md-1">
                                    <label for="idUF" class="control-label">UF</label>
                                    <div class="form-group mb-3">
                                        <select asp-for="Fornecedor.UF" class="form-control validate-required" id="Fornecedor_UF">
                                            <option value="">Selecione</option>
                                            @foreach (var uf in new List<string> { "AC", "AL", "AP", "AM", "BA", "CE", "DF", "ES", "GO", "MA", "MT", "MS", "MG", "PA", "PB", "PR", "PE", "PI", "RJ", "RN", "RS", "RO", "RR", "SC", "SP", "SE", "TO" })
                                            {
                                                <option value="@uf" selected="@(Model.Fornecedor.UF == uf)">@uf</option>
                                            }
                                        </select>
                                        <span asp-validation-for="Fornecedor.UF" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-md-5">
                                    <label class="control-label">Cidade</label>
                                    <div class="form-group mb-3">
                                        <input asp-for="Fornecedor.CIDADE" id="Fornecedor_CIDADE" class="form-control validate-required" onblur="validateCidade()" />
                                        <span asp-validation-for="Fornecedor.CIDADE" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br />

                    <!-- Dados Fiscais Card -->
                    <div class="card" id="DadosFiscaisCadastro">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <h4 style="color: #1878BB; margin-bottom: 20px;">Dados Fiscais</h4>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <hr />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2">
                                    <label class="control-label">Micro Empresa</label>
                                    <div class="form-group mb-3">
                                        <select asp-for="Fornecedor.MICROEMPRESA" class="form-control validate-required" id="Fornecedor_MICROEMPRESA" onblur="validateSelect('Fornecedor_MICROEMPRESA')">
                                            <option value="">Selecione</option>
                                            <option value="SIM ">SIM</option>
                                            <option value="NÃO">NÃO</option>
                                        </select>
                                        <span asp-validation-for="Fornecedor.MICROEMPRESA" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-md-2">
                                    <label class="control-label">Contribui ICMS</label>
                                    <div class="form-group mb-3">
                                        <select asp-for="Fornecedor.CONTRIBUIICMS" class="form-control validate-required" id="Fornecedor_CONTRIBUIICMS" onblur="validateSelect('Fornecedor_CONTRIBUIICMS')">
                                            <option value="">Selecione</option>
                                            <option value="SIM ">SIM </option>
                                            <option value="NÃO">NÃO</option>
                                        </select>
                                        <span asp-validation-for="Fornecedor.CONTRIBUIICMS" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-md-2">
                                    <label class="control-label">Contribui IPI</label>
                                    <div class="form-group mb-3">
                                        <select asp-for="Fornecedor.CONTRIBUIIPI" class="form-control validate-required" id="Fornecedor_CONTRIBUIIPI" onblur="validateSelect('Fornecedor_CONTRIBUIIPI')">
                                            <option value="">Selecione</option>
                                            <option value="SIM ">SIM </option>
                                            <option value="NÃO">NÃO</option>
                                        </select>
                                        <span asp-validation-for="Fornecedor.CONTRIBUIIPI" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="control-label">Tipo de Fornecedor</label>
                                    <div class="form-group mb-3">
                                        <select asp-for="Fornecedor.TIPOFORNECEDOR" class="form-control validate-required" id="Fornecedor_TIPOFORNECEDOR" onblur="validateSelect('Fornecedor_TIPOFORNECEDOR')">
                                            <option value="">Selecione</option>
                                            <option value="Distribuidor">Distribuidor</option>
                                            <option value="Industria">Industria</option>
                                            <option value="Transportadora">Transportadora</option>
                                        </select>
                                        <span asp-validation-for="Fornecedor.TIPOFORNECEDOR" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label class="control-label">Fornecedor de Alimentos</label>
                                    <div class="form-group mb-3">
                                        <select asp-for="Fornecedor.FORNECEDORALIMENTOS" class="form-control validate-required" id="Fornecedor_FORNECEDORALIMENTOS" onblur="validateSelect('Fornecedor_FORNECEDORALIMENTOS')">
                                            <option value="">Selecione</option>
                                            <option value="Alimentos Industrializados">Alimentos Industrializados</option>
                                            <option value="Alimentos Não Industrializados">Alimentos Não Industrializados</option>
                                            <option value="Não Fornece Alimentos">Não Fornece Alimentos</option>
                                        </select>
                                        <span asp-validation-for="Fornecedor.FORNECEDORALIMENTOS" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="control-label">Comprador Arco-Mix Principal</label>
                                    <div class="form-group mb-3">
                                        <select asp-for="Fornecedor.COMPRADORPRINCIPAL" class="form-control validate-required" id="Fornecedor_COMPRADORPRINCIPAL" onblur="validateSelect('Fornecedor_COMPRADORPRINCIPAL')">
                                            <option value="">Selecione</option>
                                            <option value="Ana Sales">Ana Sales</option>
                                            <option value="Bruno Santos">Bruno Santos</option>
                                            <option value="Carlos Costa">Carlos Costa</option>
                                            <option value="DoCarmo">DoCarmo</option>
                                            <option value="Hugo Souza">Hugo Souza</option>
                                            <option value="João Vieira">João Vieira</option>
                                            <option value="Juliana Maria">Juliana Maria</option>
                                            <option value="Juliana Medeiros">Juliana Medeiros</option>
                                            <option value="Melque">Melque</option>
                                            <option value="Raphael Mendes">Raphael Mendes</option>
                                            <option value="Gilberto">Gilberto</option>
                                        </select>
                                        <span asp-validation-for="Fornecedor.COMPRADORPRINCIPAL" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <br />

                    <!-- Dados Bancarios Card -->
                    <div class="card" id="DadosBancariosCadastro">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <h4 style="color: #1878BB; margin-bottom: 20px;">Dados Bancarios</h4>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <hr>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <label for="idBanco">Banco:</label>
                                    <div class="form-group mb-3">
                                        <select class="form-control validate-required" id="Banco" asp-for="DadosBancarios.BANCO" onblur="validateSelect('Banco')">
                                            <option value="">Selecione</option>
                                            <option value="001 - Banco do Brasil">001 - Banco do Brasil</option>
                                            <option value="033 - Santander">033 - Santander</option>
                                            <option value="104 - Caixa Econômica Federal">104 - Caixa Econômica Federal</option>
                                            <option value="237 - Bradesco">237 - Bradesco</option>
                                            <option value="341 - Itaú Unibanco">341 - Itaú Unibanco</option>
                                            <option value="399 - HSBC">399 - HSBC</option>
                                            <option value="745 - Citibank">745 - Citibank</option>
                                            <option value="389 - Mercantil do Brasil">389 - Mercantil do Brasil</option>
                                            <option value="422 - Safra">422 - Safra</option>
                                            <option value="041 - Banrisul">041 - Banrisul</option>
                                            <option value="070 - Banco de Brasília (BRB)">070 - Banco de Brasília (BRB)</option>
                                            <option value="077 - Banco Inter">077 - Banco Inter</option>
                                            <option value="237 - Banco Bradesco BBI S.A.">237 - Banco Bradesco BBI S.A.</option>
                                            <option value="756 - Sicoob">756 - Sicoob</option>
                                            <option value="748 - Sicredi">748 - Sicredi</option>
                                            <option value="212 - Banco Original">212 - Banco Original</option>
                                            <option value="260 - Nu Pagamentos (Nubank)">260 - Nu Pagamentos (Nubank)</option>
                                            <option value="290 - Pagseguro">290 - Pagseguro</option>
                                            <option value="380 - PicPay">380 - PicPay</option>
                                            <option value="323 - Mercado Pago">323 - Mercado Pago</option>
                                            <option value="332 - Acesso">332 - Acesso</option>
                                            <option value="077 - Banco Inter">077 - Banco Inter</option>
                                            <option value="208 - BTG Pactual">208 - BTG Pactual</option>
                                            <option value="136 - Unicred">136 - Unicred</option>
                                        </select>
                                        <span asp-validation-for="DadosBancarios.BANCO" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <label for="idAgencia">Agencia</label>
                                    <div class="form-group mb-3">
                                        <input type="text" class="form-control validate-required" id="Agencia" asp-for="DadosBancarios.AGENCIA" onblur="validateAgencia()" />
                                        <span asp-validation-for="DadosBancarios.AGENCIA" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <label for="idTipoConta">Tipo de Conta</label>
                                    <div class="form-group mb-3">
                                        <select class="form-control validate-required" id="TIPOCONTA" asp-for="DadosBancarios.TIPOCONTA" onblur="validateSelect('TIPOCONTA')">
                                            <option value="">Selecione</option>
                                            <option value="Pessoa Juridica">Pessoa Juridica</option>
                                            <option value="Pessoa Fisica">Pessoa Fisica</option>
                                            <option value="Poupança">Poupança</option>
                                            <option value="Conta Investimento">Conta Investimento</option>
                                        </select>
                                        <span asp-validation-for="DadosBancarios.TIPOCONTA" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <label for="idNConta">Nº Conta:</label>
                                    <div class="form-group mb-3">
                                        <input type="text" class="form-control validate-required" id="NumeroConta" asp-for="DadosBancarios.NUMEROCONTA" onblur="validateNumeroConta()" />
                                        <span asp-validation-for="DadosBancarios.NUMEROCONTA" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label for="idCNPJConta">CNPJ Titular Conta:</label>
                                    <div class="form-group mb-3">
                                        <input type="text" class="form-control validate-required" id="CNPJContaTitular" asp-for="DadosBancarios.CNPJCONTATITULAR" onblur="validateCNPJContaTitular()" />
                                        <span asp-validation-for="DadosBancarios.CNPJCONTATITULAR" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <br />

                    <!-- Submit Button Row -->
                    <div class="row">
                        <div class="col">
                            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                        </div>
                    </div>
                    <br />
                    <!-- Add other sections similarly with proper IDs and structure -->
                </form>
            </div>
        </div>
    </div>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script type="text/javascript">
        function showSuccessMessage() {
            alert("Dados Enviados para Analise com Sucesso");
            return true;
        }
        var isValidationInProgress = false;

        function validateField(fieldId, validationType = 'default') {
            if (isValidationInProgress) return true; // Skip if validation is already in progress

            var field = document.getElementById(fieldId);
            if (field) {
                if (validationType === 'default' && !field.value.trim()) {
                    isValidationInProgress = true;
                    alert("Campo Precisa ser preenchido");
                    setTimeout(function () { field.focus(); isValidationInProgress = false; }, 10);
                    return false;
                } else if (validationType === '9digitos' && !/^\d{9}$/.test(field.value.trim())) {
                    isValidationInProgress = true;
                    alert("Campo deve conter exatamente 9 dígitos");
                    setTimeout(function () { field.focus(); isValidationInProgress = false; }, 10);
                    return false;
                } else if (validationType === '7digitos' && !/^\d{7}$/.test(field.value.trim())) {
                    isValidationInProgress = true;
                    alert("Campo deve conter exatamente 7 dígitos");
                    setTimeout(function () { field.focus(); isValidationInProgress = false; }, 10);
                    return false;
                } else if (validationType === '8digitos' && !/^\d{8}$/.test(field.value.trim())) {
                    isValidationInProgress = true;
                    alert("Campo deve conter exatamente 8 dígitos");
                    setTimeout(function () { field.focus(); isValidationInProgress = false; }, 10);
                    return false;
                } else if (validationType === 'digits' && !/^\d+$/.test(field.value.trim())) {
                    isValidationInProgress = true;
                    alert("Campo deve conter apenas dígitos");
                    setTimeout(function () { field.focus(); isValidationInProgress = false; }, 10);
                    return false;
                } else if (validationType === '14digits' && !/^\d{14}$/.test(field.value.trim())) {
                    isValidationInProgress = true;
                    alert("Campo deve conter exatamente 14 dígitos");
                    setTimeout(function () { field.focus(); isValidationInProgress = false; }, 10);
                    return false;
                }
            }
            return true;
        }

        function validateRazaoSocial() { return validateField("Fornecedor_RAZAOSOCIAL"); }
        function validateFantasia() { return validateField("Fornecedor_FANTASIA"); }
        function validateIE() { return validateField("Fornecedor_IE", '9digitos'); }
        function validateCNAE() { return validateField("Fornecedor_CNAE", '7digitos'); }
        function validateCEP() { return validateField("Fornecedor_CEP", '8digitos'); }
        function validateBairro() { return validateField("Fornecedor_BAIRRO"); }
        function validateCidade() { return validateField("Fornecedor_CIDADE"); }
        function validateLogradouro() { return validateField("Fornecedor_LOGRADOURO"); }
        function validateAgencia() { return validateField("Agencia", 'digits'); }
        function validateNumeroConta() { return validateField("NumeroConta", 'digits'); }
        function validateCNPJContaTitular() { return validateField("CNPJContaTitular", '14digits'); }

        function validateSelect(selectId) {
            if (isValidationInProgress) return true; // Skip if validation is already in progress

            var select = document.getElementById(selectId);
            if (select && select.value === "") {
                isValidationInProgress = true;
                alert("Esse campo não pode ficar em branco");
                setTimeout(function () { select.focus(); isValidationInProgress = false; }, 10);
                return false;
            }
            return true;
        }

        function fetchAddress() {
            var cep = document.getElementById("Fornecedor_CEP").value.replace(/\D/g, ''); // Remove non-digit characters
            if (cep.length === 8) {
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            document.getElementById("Fornecedor_LOGRADOURO").value = data.logradouro;
                            document.getElementById("Fornecedor_BAIRRO").value = data.bairro;
                            document.getElementById("Fornecedor_CIDADE").value = data.localidade;
                            document.getElementById("Fornecedor_UF").value = data.uf;
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching address:', error);
                        alert("Erro ao buscar endereço.");
                    });
            }
        }

        // Make Enter key act like Tab in the form
        document.addEventListener('keydown', function (event) {
            if (event.key === "Enter") {
                event.preventDefault(); // Prevent default Enter behavior
                // Find the next focusable element
                var currentElement = event.target;
                var focusableElements = document.querySelectorAll('button, [href], input, select, textarea');
                var currentIndex = Array.from(focusableElements).indexOf(currentElement);
                var nextIndex = (currentIndex + 1) % focusableElements.length;
                focusableElements[nextIndex].focus();
            }
        });
    </script>
}
